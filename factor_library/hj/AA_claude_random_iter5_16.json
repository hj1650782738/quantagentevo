{
  "metadata": {
    "created_at": "2026-01-23T03:46:08.062511",
    "total_factors": 16,
    "source": "factor_library/AA_top80_RankIC_AA_claude_123_csi300.json",
    "note": "Random split iter5 from AA_top80_RankIC_AA_claude_123_csi300.json"
  },
  "factors": {
    "896d3977ff2e6246": {
      "factor_id": "896d3977ff2e6246",
      "factor_name": "Quiet_Institutional_Markup_Factor",
      "factor_expression": "WMA(RANK(TS_PCTCHANGE($close, 10) / ((1 + (TS_MEAN($volume, 5) - TS_MEAN($volume, 10)) / (TS_STD($volume, 20) + 1e-8)) * (TS_STD($return, 10) + 1e-6))), 3)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"WMA(RANK(TS_PCTCHANGE($close, 10) / ((1.0 + (TS_MEAN($volume, 5) - TS_MEAN($volume, 10)) / (TS_STD($volume, 20) + 1e-8)) * (TS_STD(TS_PCTCHANGE($close, 1), 10) + 1e-6))), 3)\" # Your output factor expression will be filled in here\n    name = \"Quiet_Institutional_Markup_Factor\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor identifies 'Quiet Institutional Markup' by weighting price momentum by the inverse of volume acceleration and price volatility. It specifically rewards assets where the price is rising while volume is decelerating (negative slope), indicating a path of least resistance where supply is exhausted.",
      "factor_formulation": "QIM = \\text{WMA}\\left(\\text{RANK}\\left(\\frac{\\text{TS\\_PCTCHANGE}(close, 10)}{\\left(1 + \\frac{\\text{TS\\_MEAN}(volume, 5) - \\text{TS\\_MEAN}(volume, 10)}{\\text{TS\\_STD}(volume, 20) + 1e-8}\\right) \\cdot (\\text{TS\\_STD}(\\text{TS\\_PCTCHANGE}(close, 1), 10) + 1e-6)}\\right), 3\\right)",
      "metadata": {
        "experiment_id": "2026-01-19_13-05-39-450069",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A factor that identifies 'Quiet Institutional Markup' by weighting price momentum by the inverse of volume trend (acceleration) and price volatility, specifically rewarding price gains accompanied by volume deceleration.\n                Concise Observation: The previous SEMZ factor achieved an IR of 1.166 by using a volume Z-score denominator, but it failed to distinguish between steady low volume and the specific state of volume contraction which often characterizes the most sustainable institutional markups.\n                Concise Justification: Replacing the absolute volume Z-score with a 5-day volume slope (linear regression or simple difference) allows the factor to specifically target the divergence between price direction and volume intensity. This identifies 'efficient' moves where less effort (volume) is required to move the price, signaling a lack of selling pressure.\n                Concise Knowledge: In physics-based instrument data, if price momentum is positive while volume acceleration is negative (decelerating volume), it indicates a 'path of least resistance' where institutional buying has exhausted available supply; when this occurs under low price volatility, the trend is more likely to persist than high-volume 'noisy' breakouts.\n                concise Specification: The factor is defined as: (TS_PCTCHANGE($close, 10) / (1 + (TS_MEAN($volume, 5) - TS_MEAN($volume, 10)) / TS_STD($volume, 20))) / (TS_STD(TS_PCTCHANGE($close, 1), 10) + 1e-6). The numerator is the 10-day price return, and the denominator combines a volume trend component (5-day mean vs 10-day mean) with 10-day price volatility. The final output is cross-sectionally ranked and smoothed with a 3-day moving average.\n                ",
        "initial_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "planning_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "created_at": "2026-01-19T22:22:40.593719"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1910168147527776,
        "ICIR": 0.0494070174349099,
        "1day.excess_return_without_cost.std": 0.0048928466236803,
        "1day.excess_return_with_cost.annualized_return": 0.0085753745625181,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002362683512188,
        "1day.excess_return_without_cost.annualized_return": 0.0562318675900932,
        "1day.excess_return_with_cost.std": 0.0048941116555797,
        "Rank IC": 0.021665933256401,
        "IC": 0.0073018885882809,
        "1day.excess_return_without_cost.max_drawdown": -0.1204237022376163,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.7449590955453519,
        "1day.pa": 0.0,
        "l2.valid": 0.9964488986958692,
        "Rank ICIR": 0.1532329977198874,
        "l2.train": 0.9939334412800682,
        "1day.excess_return_with_cost.information_ratio": 0.1135770925034258,
        "1day.excess_return_with_cost.mean": 3.603098555679907e-05
      },
      "feedback": {
        "observations": "The current iteration explored three variations of the 'Quiet Institutional Markup' hypothesis, focusing on the interaction between price momentum and volume deceleration. While the theoretical framework remains compelling, the empirical results (IC: 0.0073, IR: 0.745) underperformed the SOTA (IC: 0.0090, IR: 1.166). The 'Quiet_Institutional_Markup_Factor' utilized a complex denominator involving volume acceleration and price volatility, which may have introduced noise. The 'Volume_Contraction_Efficiency_Factor' used a regression slope (REGBETA) to penalize volume, but the short 5-day window might be too sensitive to daily fluctuations. The 'Path_Least_Resistance_Index' offered a simpler approach but likely lacked the precision to distinguish between true institutional markup and simple liquidity exhaustion.",
        "hypothesis_evaluation": "The results partially support the hypothesis that volume deceleration during price increases is a valid signal, but the current implementations are likely over-parameterized or improperly scaled. The divergence between volume and price is a subtle signal; the current use of raw volume means and standard deviations in the denominator may be creating extreme values that degrade the Information Ratio. The hypothesis needs to move away from complex ratios and toward more robust indicators of 'effortless' price movement.",
        "decision": false,
        "reason": "The previous factors were penalized by high complexity in their volume-acceleration components. By switching the focus to 'Efficiency'—defined as the ratio of price change to turnover—and incorporating the high-low range as a proxy for volatility, we can capture the 'path of least resistance' more cleanly. Using turnover (volume/shares outstanding) or volume rank instead of raw volume averages will improve cross-sectional stability. A simpler, more robust formulation will reduce the risk of overfitting observed in the current complex iterations."
      },
      "cache_location": null
    },
    "fe1a75ef682a2501": {
      "factor_id": "fe1a75ef682a2501",
      "factor_name": "Ranked_Exhaustion_Shadow_Dominance",
      "factor_expression": "RANK((MIN($open, $close) - $low) / ($high - $low + 1e-6)) * RANK($volume / (TS_MEAN($volume, 5) + 1e-8)) * (TS_ZSCORE($close, 5) < -1 ? ABS(TS_ZSCORE($close, 5)) : 0)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK((MIN($open, $close) - $low) / ($high - $low + 1e-6)) * RANK($volume / (TS_MEAN($volume, 5) + 1e-8)) * (TS_ZSCORE($close, 5) < -1 ? ABS(TS_ZSCORE($close, 5)) : 0)\" # Your output factor expression will be filled in here\n    name = \"Ranked_Exhaustion_Shadow_Dominance\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A cross-sectionally stabilized version of the Exhaustion-Weighted Shadow Dominance. It ranks the shadow dominance and volume surge to reduce the impact of outliers, then applies the 5-day price exhaustion filter (Z-score) to isolate high-conviction reversal points.",
      "factor_formulation": "SD = \\frac{\\min(open, close) - low}{high - low + 1e-6}, VS = \\frac{volume}{TS\\_MEAN(volume, 5)}, Factor = RANK(SD) \\times RANK(VS) \\times (TS\\_ZSCORE(close, 5) < -1 ? ABS(TS\\_ZSCORE(close, 5)) : 0)",
      "metadata": {
        "experiment_id": "2026-01-19_13-05-20-154982",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: Short-term reversals are driven by 'Exhaustion-Weighted Shadow Dominance' (EWSD), where the Volume-Weighted Shadow Dominance (VWSD) is non-linearly amplified by the degree of price extension below a 5-day moving average, normalized by the 5-day standard deviation.\n                Concise Observation: While VWSD improved the Information Coefficient (IC), the deterioration in Information Ratio (IR) and drawdown suggests the signal triggers in non-extreme price levels where mean reversion is weak; simple 3-day returns or ranks fail to distinguish between a healthy pullback and a true exhaustion point.\n                Concise Justification: By replacing the simple momentum multiplier with a Z-score (price relative to its 5-day moving average divided by 5-day standard deviation), we normalize the 'oversold' condition across different volatility regimes, ensuring that the shadow dominance signal is only amplified when the price is significantly extended from its recent equilibrium.\n                Concise Knowledge: If a stock exhibits strong intraday buying support (lower shadow dominance) on high volume while trading at a significant negative Z-score relative to its short-term mean, the probability of a reversal is higher; the Z-score acts as a volatility-adjusted exhaustion filter that outperforms simple momentum or binary filters.\n                concise Specification: 1. LS = min(open, close) - low; 2. US = high - max(open, close); 3. SD = LS / (LS + US + 1e-6); 4. VS = volume / mean(volume, 5); 5. Z_Score = (close - mean(close, 5)) / (std(close, 5) + 1e-6); 6. Factor = SD * VS * (Z_Score < -1 ? abs(Z_Score) : 0). Use a 5-day window for mean and standard deviation to capture short-term exhaustion.\n                ",
        "initial_direction": "参考以下组合给出假设。组合3包含RESI5（表达式：Resi(, 5)/，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less(, )-)/，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std(, 5)/，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "planning_direction": "参考以下组合给出假设。组合3包含RESI5（表达式：Resi(, 5)/，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less(, )-)/，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std(, 5)/，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "created_at": "2026-01-19T21:43:17.571264"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.09686166305869,
        "ICIR": 0.0561789985312876,
        "1day.excess_return_without_cost.std": 0.0045985435918715,
        "1day.excess_return_with_cost.annualized_return": 0.0096240355041287,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002399967024826,
        "1day.excess_return_without_cost.annualized_return": 0.0571192151908734,
        "1day.excess_return_with_cost.std": 0.0045998758505915,
        "Rank IC": 0.0230284109397066,
        "IC": 0.008502453034096,
        "1day.excess_return_without_cost.max_drawdown": -0.0872655661341231,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.8051437859270764,
        "1day.pa": 0.0,
        "l2.valid": 0.9964140520495935,
        "Rank ICIR": 0.1521385507914535,
        "l2.train": 0.991513425611256,
        "1day.excess_return_with_cost.information_ratio": 0.1356196526167619,
        "1day.excess_return_with_cost.mean": 4.0437123966927705e-05
      },
      "feedback": {
        "observations": "The current iteration focused on refining the 'Exhaustion-Weighted Shadow Dominance' (EWSD) hypothesis by testing hard thresholds versus continuous mappings and cross-sectional ranking. The results show a significant improvement in the Information Coefficient (IC), rising from 0.0052 to 0.0085, and a notable reduction in Max Drawdown (-0.087 vs -0.110). However, the Annualized Return and Information Ratio (IR) have slightly decreased compared to the SOTA. This suggests that while the current factors (likely the 'Continuous_EWSD_Stabilized') have better predictive power for the general universe (higher IC), the previous SOTA was more effective at capturing the top-tier alpha for the long-short portfolio construction.",
        "hypothesis_evaluation": "The hypothesis that price exhaustion (Z-score) amplifies the signal of shadow dominance is strongly supported by the improved IC and lower drawdown. The 'Continuous_EWSD_Stabilized' approach likely contributed to the IC gain by providing a smoother signal across more instruments. However, the drop in annualized return suggests that the non-linear 'amplification' might be diluting the signal strength of the most extreme reversal candidates. The trade-off between a robust continuous signal and a concentrated threshold-based signal needs to be balanced.",
        "decision": false,
        "reason": "1. Using a simple volume mean doesn't account for the 'cost' of the shadow (volatility); normalizing volume by ATR or using 'Relative Volume' relative to volatility can isolate true exhaustion. 2. To recover the Annualized Return lost in the continuous version, applying a power function (e.g., MAX(0, -Z)^2) will maintain the continuous nature while restoring the emphasis on the 'tails' (extreme exhaustion) which often drive the highest excess returns. 3. The current complexity is low (ER < 6, PC is minimal), allowing room for these more refined mathematical expressions without risking overfitting."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260119_210519",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210519",
        "factor_dir": "f553b7f97ee94d35b1f43e8cccca63bd",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210519/f553b7f97ee94d35b1f43e8cccca63bd/result.h5"
      }
    },
    "0ae7d8fd9c2be96f": {
      "factor_id": "0ae7d8fd9c2be96f",
      "factor_name": "ZScored_Trend_Liquidity_Synergy_20D",
      "factor_expression": "RANK(TS_ZSCORE(TS_SUM($return, 20), 20)) * RANK(TS_CORR($volume, $return, 20))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_ZSCORE(TS_SUM(TS_PCTCHANGE($close, 1), 20), 20)) * RANK(TS_CORR($volume, TS_PCTCHANGE($close, 1), 20))\" # Your output factor expression will be filled in here\n    name = \"ZScored_Trend_Liquidity_Synergy_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A cross-sectionally standardized factor that combines normalized Trend Efficiency with a volume-confirmation weight. It uses TS_ZSCORE to ensure the efficiency metric is comparable across stocks before interacting it with the volume-price correlation, aiming to improve the Information Ratio by dampening extreme idiosyncratic outliers.",
      "factor_formulation": "\\text{Factor} = \\text{RANK}(\\text{TS\\_ZSCORE}(\\sum \\text{return}, 20)) \\times \\text{RANK}(\\text{TS\\_CORR}(\\text{volume}, \\text{return}, 20))",
      "metadata": {
        "experiment_id": "2026-01-19_15-18-38-517532",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: The 20-day Trend Efficiency (Return/Volatility) provides a more robust signal than RSQR when conditioned by a 20-day Volume-Price Divergence filter to identify sustainable institutional trends.\n                Concise Observation: The previous use of RSQR and VPC as a simple product improved IC but degraded IR and Drawdown, suggesting that the linear interaction of two noisy metrics creates extreme values that destabilize portfolio construction.\n                Concise Justification: Trend Efficiency (Return divided by Volatility) inherently accounts for the risk-reward profile of the price move, making it more compatible with IR-focused strategies than RSQR, which only measures fit linearity. Using a conditional volume-price correlation ensures we only capture momentum backed by liquidity participation.\n                Concise Knowledge: If a price trend exhibits high risk-adjusted returns (Trend Efficiency) while maintaining a positive relationship between volume and price direction, it is likely to persist; when high efficiency occurs on diverging volume, it indicates exhaustion.\n                concise Specification: Define Trend_Efficiency_20 as the 20-day price change divided by the 20-day standard deviation of daily returns. Define VPC_20 as the 20-day Pearson correlation between volume and returns. The final factor is Trend_Efficiency_20 multiplied by a sigmoid-scaled VPC_20 to dampen signals with poor volume confirmation.\n                ",
        "initial_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "planning_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "created_at": "2026-01-19T23:53:23.376470"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1221271369095913,
        "ICIR": 0.0443284295178879,
        "1day.excess_return_without_cost.std": 0.0043597034149179,
        "1day.excess_return_with_cost.annualized_return": 0.0355866595823587,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003490002113331,
        "1day.excess_return_without_cost.annualized_return": 0.0830620502972978,
        "1day.excess_return_with_cost.std": 0.0043604995060748,
        "Rank IC": 0.0232928959737599,
        "IC": 0.0059749128907132,
        "1day.excess_return_without_cost.max_drawdown": -0.1147158960576917,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.2349723172533569,
        "1day.pa": 0.0,
        "l2.valid": 0.9965563223306172,
        "Rank ICIR": 0.1789970212152254,
        "l2.train": 0.993247167687365,
        "1day.excess_return_with_cost.information_ratio": 0.5290083215909561,
        "1day.excess_return_with_cost.mean": 0.0001495237797578
      },
      "feedback": {
        "observations": "The current iteration demonstrates a significant improvement in predictive power and risk-adjusted returns compared to the SOTA. The Information Ratio (IR) increased from 0.88 to 1.23, and the Annualized Return rose from 5.67% to 8.31%. The Information Coefficient (IC) also saw a healthy boost to 0.0059. However, the Max Drawdown deepened from -0.0736 to -0.1147, suggesting that while the signal is stronger, it may introduce higher tail risk or sensitivity to market regimes. The success of the 'ZScored_Trend_Liquidity_Synergy_20D' and 'Conditional_Institutional_Momentum_20D' suggests that the interaction between trend efficiency and volume confirmation is a potent alpha source.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that 20-day Trend Efficiency, when conditioned by Volume-Price Divergence filters, provides a robust signal. Specifically, the use of Rank-based interaction and conditional gates (VPC > 0) successfully isolated sustainable trends. The improvement in IR and IC confirms that 'Institutional Trends' are better captured when price momentum is synchronized with volume, rather than looking at price action in isolation.",
        "decision": true,
        "reason": "While the current 20-day window is effective, static windows can suffer from 'lag' or 'cliff effects' at the window boundary. Using EWMSD will make the Trend Efficiency more responsive to recent volatility shifts. Furthermore, the current VPC (correlation) only measures direction; adding a Relative Volume component ensures the 'Institutional' part of the hypothesis is better represented by actual high-conviction participation rather than just correlated low-volume drift."
      },
      "cache_location": null
    },
    "a80c9c7bd9bb7aef": {
      "factor_id": "a80c9c7bd9bb7aef",
      "factor_name": "Supply_Exhaustion_Efficiency_V2",
      "factor_expression": "RANK(TS_PCTCHANGE($close, 10) / (RANK(TS_MEAN($volume, 10)) + RANK(TS_MEAN($high - $low, 10)) + 1e-6))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_PCTCHANGE($close, 10) / (RANK(TS_MEAN($volume, 10)) + RANK(TS_MEAN($high - $low, 10)) + 1e-6))\" # Your output factor expression will be filled in here\n    name = \"Supply_Exhaustion_Efficiency_V2\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A simplified version of the Supply Exhaustion Efficiency factor that measures the ratio of 10-day price returns to the combined rank of volume and price range. It identifies 'quiet' institutional markups where price moves with minimal friction (low volume and low volatility).",
      "factor_formulation": "SEE = RANK(TS\\_PCTCHANGE(close, 10) / (RANK(TS\\_MEAN(volume, 10)) + RANK(TS\\_MEAN(high - low, 10)) + 1e-6))",
      "metadata": {
        "experiment_id": "2026-01-19_13-05-39-450069",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A factor that identifies 'Low-Resistance Momentum' by measuring the divergence between price momentum and the cumulative 'Effort-to-Result' ratio, specifically rewarding assets where price acceleration is achieved with declining volume-volatility intensity.\n                Concise Observation: Previous iterations (SEMZ, SEE) showed that dividing momentum by volume and volatility ranks is highly effective (IR 1.17), but static 10-day windows or simple derivatives of the ratio failed because they didn't account for the non-linear 'breakout' nature of efficiency acceleration.\n                Concise Justification: By using a 5-day/20-day ratio of the 'Price-to-Friction' efficiency, we capture the second derivative of the trend. Normalizing the denominator as a sum of ranks (Volume Rank + Volatility Rank) rather than a product prevents extreme values from zeroing out the signal, creating a more stable and timely entry signal for institutional markups.\n                Concise Knowledge: In this physics-based instrument data, a sustainable trend occurs when price displacement increases while the 'friction' (the product of volume rank and intraday volatility) decreases; if the ratio of price change to this friction accelerates, it signifies a transition into a 'low-resistance' markup phase driven by supply exhaustion.\n                concise Specification: The factor is defined as: (TS_PCTCHANGE($close, 5) / (Rank(TS_MEAN($volume, 5)) + Rank(TS_MEAN($high - $low, 5)) + 1e-6)) / (TS_PCTCHANGE($close, 20) / (Rank(TS_MEAN($volume, 20)) + Rank(TS_MEAN($high - $low, 20)) + 1e-6) + 1e-6). The final output is cross-sectionally ranked and smoothed by a 3-day moving average.\n                ",
        "initial_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "planning_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "created_at": "2026-01-19T22:37:56.224610"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1449705776569284,
        "ICIR": 0.0311706154491818,
        "1day.excess_return_without_cost.std": 0.0049518587354691,
        "1day.excess_return_with_cost.annualized_return": 0.0112843287224553,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002453490332562,
        "1day.excess_return_without_cost.annualized_return": 0.0583930699149862,
        "1day.excess_return_with_cost.std": 0.0049538923676206,
        "Rank IC": 0.0216556153492172,
        "IC": 0.0048181969710054,
        "1day.excess_return_without_cost.max_drawdown": -0.1093061371274018,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.7643716707308237,
        "1day.pa": 0.0,
        "l2.valid": 0.9965891251246892,
        "Rank ICIR": 0.146491587927195,
        "l2.train": 0.993826717224926,
        "1day.excess_return_with_cost.information_ratio": 0.147652458973292,
        "1day.excess_return_with_cost.mean": 4.741314589266944e-05
      },
      "feedback": {
        "observations": "The current iteration explored the 'Low-Resistance Momentum' hypothesis using three variations: a ratio of short-term to long-term efficiency (LRMA), a simplified 10-day efficiency measure (SEE), and a volatility-adjusted friction model (RFM). While the theoretical framework of measuring price acceleration against volume/volatility 'friction' is sound, the current implementations failed to outperform the SOTA result. The IC dropped from 0.0090 to 0.0048, and the Information Ratio saw a significant decline from 1.166 to 0.764, suggesting that the current mathematical formulations are either too noisy or the 'friction' denominator is over-penalizing valid momentum signals.",
        "hypothesis_evaluation": "The hypothesis that 'Low-Resistance Momentum' identifies superior entries is partially supported by the fact that the factors still yield positive annualized returns (5.8%), but the deterioration compared to SOTA suggests the 'Effort-to-Result' ratio needs refinement. Specifically, the 'LRMA' factor uses a nested ratio of ranks which might be creating an unstable distribution. The 'SEE' factor's reliance on cross-sectional ranks for both volume and price range in the denominator might be too restrictive, as it treats high-volume breakouts (which can be healthy) the same as high-volatility churn.",
        "decision": false,
        "reason": "Current factors rely heavily on RANK(), which flattens the signal and loses the physical intensity of the price/volume relationship. By shifting to a 'Efficiency Score' based on the ratio of returns to the standard deviation of volume (measuring volume stability) and the average true range (measuring price smoothness), we can better capture 'frictionless' movement. Additionally, the previous factors used a complex denominator; simplifying this to a single 'Friction Factor' using Z-scores will improve signal-to-noise ratios and reduce the risk of overfitting observed in the complex LRMA formulation."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260119_210539",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210539",
        "factor_dir": "3ae29170ee5648cf9b37c9c4c7fd843c",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210539/3ae29170ee5648cf9b37c9c4c7fd843c/result.h5"
      }
    },
    "c6f3304d5983dbc2": {
      "factor_id": "c6f3304d5983dbc2",
      "factor_name": "Relative_Intensity_Stability_Index",
      "factor_expression": "(RANK(WMA($close, 15)) - RANK(WMA(LOG($volume + 1), 15))) / (TS_STD(LOG($volume + 1), 15) + 1e-8)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"(RANK(WMA($close, 15)) - RANK(WMA(LOG($volume + 1), 15))) / (TS_STD(LOG($volume + 1), 15) + 1e-8)\" # Your output factor expression will be filled in here\n    name = \"Relative_Intensity_Stability_Index\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor measures the spread between price momentum and volume intensity, normalized by volume stability. It uses the log-transformed volume to reduce the impact of extreme outliers and focuses on the consistency of the volume trend over a 15-day period.",
      "factor_formulation": "(RANK(WMA($close, 15)) - RANK(WMA(LOG($volume + 1), 15))) / (TS_STD(LOG($volume + 1), 15) + 1e-8)",
      "metadata": {
        "experiment_id": "2026-01-19_13-05-39-450069",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A factor that weights the price-volume rank divergence by the inverse of volume volatility (stability) identifies high-conviction institutional accumulation while filtering out noisy speculative spikes.\n                Concise Observation: Previous successes used volume Z-scores and smoothed volume ratios to improve the Information Ratio, but the current model still struggles with 'noisy' volume spikes that degrade the signal-to-noise ratio of the price-volume divergence.\n                Concise Justification: Institutional accumulation typically occurs with steady, consistent liquidity rather than erratic spikes. Dividing the divergence signal by the 20-day standard deviation of volume (volume stability) ensures the factor prioritizes 'clean' accumulation phases over volatile, speculative ones.\n                Concise Knowledge: If price momentum leads volume intensity during periods of low volume dispersion, the signal is more likely to represent institutional accumulation; when volume volatility is high, the same price-volume divergence is often noise from retail speculation or wash trading.\n                concise Specification: The factor is defined as: (Rank(TS_PCTCHANGE(Close, 20)) - Rank((Volume - TS_MEAN(Volume, 20)) / TS_STD(Volume, 20))) / (TS_STD(Volume, 20) / TS_MEAN(Volume, 20) + 1e-6). The denominator represents the coefficient of variation for volume over 20 days. All ranks are cross-sectional.\n                ",
        "initial_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "planning_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "created_at": "2026-01-19T21:30:19.692627"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1472560559895442,
        "ICIR": 0.0287894015803919,
        "1day.excess_return_without_cost.std": 0.0048625692098862,
        "1day.excess_return_with_cost.annualized_return": -0.0044716169524387,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0001812296502924,
        "1day.excess_return_without_cost.annualized_return": 0.0431326567695934,
        "1day.excess_return_with_cost.std": 0.004863486362547,
        "Rank IC": 0.0214230198160203,
        "IC": 0.0042445640372246,
        "1day.excess_return_without_cost.max_drawdown": -0.1239644437013239,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.574978936400623,
        "1day.pa": 0.0,
        "l2.valid": 0.9965737050305856,
        "Rank ICIR": 0.1522107416210549,
        "l2.train": 0.9936068754106084,
        "1day.excess_return_with_cost.information_ratio": -0.0595975508678463,
        "1day.excess_return_with_cost.mean": -1.8788306522851687e-05
      },
      "feedback": {
        "observations": "The current iteration explored three different implementations of the 'Price-Volume Rank Divergence weighted by Stability' hypothesis. While the theoretical framework is sound, the current empirical results (Annualized Return 0.043, IC 0.0042) underperform the SOTA (Annualized Return 0.075, IC 0.0065). The 'Stable_Institutional_Accumulation_Factor' and 'Clean_Volume_Momentum_Divergence' both attempted to use volume standard deviation as a penalty for noise. The results suggest that while the divergence concept has merit, the current weighting mechanism (inverse of volume volatility) might be too restrictive or the look-back windows (10-20 days) are capturing lagging signals rather than leading ones.",
        "hypothesis_evaluation": "The hypothesis that volume stability identifies high-conviction institutional accumulation is partially supported in theory, but the current mathematical formulations are likely too complex or incorrectly scaled. The use of 'RANK(Price) - RANK(Volume)' is a classic divergence measure, but dividing by a raw standard deviation or coefficient of variation creates extreme values when volume is very stable, potentially leading to outlier-driven signals that don't generalize well.",
        "decision": false,
        "reason": "The previous factors focused on the stability of volume alone. However, institutional accumulation is characterized by persistent buying pressure. By replacing raw volume with 'Volume Force' (Volume * TS_PCTCHANGE(close, 1)), we capture the intent. Using a Time-Series Rank (TS_RANK) of this force over a 20-day window, and then measuring its divergence from price momentum, should provide a cleaner signal. To address the complexity issues, we will simplify the stability component to a simple moving average of the force's sign consistency, reducing the number of nested functions and free parameters."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260119_210539",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210539",
        "factor_dir": "6f35393e01504ba3869d8c9141945b4a",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210539/6f35393e01504ba3869d8c9141945b4a/result.h5"
      }
    },
    "36df515afb1a008c": {
      "factor_id": "36df515afb1a008c",
      "factor_name": "Ranked_EMA_Reversion_Exhaustion_Factor",
      "factor_expression": "RANK(($close / (EMA($close, 5) + 1e-8) - 1) * POW(TS_CORR($close, SEQUENCE(10), 10), 2)) + RANK(TS_MEAN((($high - $low) / ($close + 1e-8)) * ($volume / (TS_MEAN($volume, 10) + 1e-8)), 3))",
      "factor_implementation_code": "",
      "factor_description": "This factor identifies relative price exhaustion by cross-sectionally ranking the 5-day EMA deviation and multiplying it by the squared 10-day trend stability. It adds a 3-day relative volume-weighted range to confirm liquidity climaxes, using cross-sectional ranking for the entire expression to ensure comparability across the universe.",
      "factor_formulation": "Factor = RANK\\left( \\left( \\frac{close}{EMA(close, 5)} - 1 \\right) \\cdot TS\\_CORR(close, SEQUENCE(10), 10)^2 \\right) + RANK\\left( TS\\_MEAN\\left( \\frac{high - low}{close + 1e-8} \\cdot \\frac{volume}{TS\\_MEAN(volume, 10) + 1e-8}, 3 \\right) \\right)",
      "metadata": {
        "experiment_id": "2026-01-19_08-47-26-074588",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: The mean-reversion signal is optimized by combining a 5-day price-to-EMA deviation with a squared 10-day trend stability filter (RSQR10^2) and a 3-day relative volume-weighted range (RVR3) to identify liquidity-backed exhaustion.\n                Concise Observation: Previous attempts using complex Z-scores of intraday shadows (Z-VWKLOW3) failed to improve performance, likely due to over-parameterization and noise in the shadow calculation, whereas the squared RSQR filter has consistently proven effective at reducing 'falling knife' risks.\n                Concise Justification: The failure of Hypothesis 7 suggests that the triple-nested Z-score of shadows was too noisy. By replacing it with a simpler Relative Volume-weighted Range (RVR), we capture the same 'exhaustion' logic (high volume + wide range) with fewer parameters. Using EMA(5) instead of SMA(5) maintains sensitivity to recent price turns while the squared RSQR ensures we only trade in mature, stable trends.\n                Concise Knowledge: If a price deviation is measured against an EMA and filtered by squared trend stability, it captures high-conviction reversals; when this is combined with a volume-weighted range relative to its recent average, it identifies 'liquidity climaxes' where high trading activity at price extremes signals a turning point in this physics-value instrument data.\n                concise Specification: The factor is defined as: ((CLOSE / EMA(CLOSE, 5) - 1) * (RSQR10^2)) + SMA(((HIGH - LOW) / CLOSE) * (VOLUME / SMA(VOLUME, 10)), 3). RSQR10 is the 10-day R-squared of the close price; the second term is the 3-day average of the daily range (high-low) normalized by close and scaled by the 10-day relative volume ratio.\n                ",
        "initial_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare($close, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：($high-$low)/$open，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs($close/Ref($close, 1)-1)*$volume, 5)/(Mean(Abs($close/Ref($close, 1)-1)*$volume, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。组合2包含ROC60（表达式：Ref($close, 60)/$close，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr($close, Log($volume+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std($volume, 5)/($volume+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。组合3包含RESI5（表达式：Resi($close, 5)/$close，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less($open, $close)-$low)/$open，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std($close, 5)/$close，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "planning_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare($close, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：($high-$low)/$open，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs($close/Ref($close, 1)-1)*$volume, 5)/(Mean(Abs($close/Ref($close, 1)-1)*$volume, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。组合2包含ROC60（表达式：Ref($close, 60)/$close，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr($close, Log($volume+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std($volume, 5)/($volume+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。组合3包含RESI5（表达式：Resi($close, 5)/$close，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less($open, $close)-$low)/$open，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std($close, 5)/$close，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "created_at": "2026-01-19T18:40:11.378335"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1152239564012357,
        "ICIR": 0.0501259795564825,
        "1day.excess_return_without_cost.std": 0.004379605886936,
        "1day.excess_return_with_cost.annualized_return": 0.0153756678778558,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002630712728567,
        "1day.excess_return_without_cost.annualized_return": 0.062610962939904,
        "1day.excess_return_with_cost.std": 0.0043815246865,
        "Rank IC": 0.0259790713607474,
        "IC": 0.0071298931397198,
        "1day.excess_return_without_cost.max_drawdown": -0.1056704303258209,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.9266737775171104,
        "1day.pa": 0.0,
        "l2.valid": 0.9963477327659104,
        "Rank ICIR": 0.1878333356451531,
        "l2.train": 0.9943507490495196,
        "1day.excess_return_with_cost.information_ratio": 0.2274679679709574,
        "1day.excess_return_with_cost.mean": 6.460364654561298e-05
      },
      "feedback": {
        "observations": "The experiment tested the 'EMA_Deviation_Stability_LAPS_Factor', which implements a mean-reversion logic combined with trend stability and a liquidity-weighted range. While the factor logic is theoretically sound, the performance metrics (Annualized Return: 0.0626, IR: 0.9267, IC: 0.0071) significantly underperform compared to the SOTA results (Annualized Return: 0.1057, IR: 1.5351, IC: 0.0074). The Max Drawdown is also deeper than the SOTA. The current implementation uses a complex additive structure between price deviation and volume-weighted range, which might be diluting the primary mean-reversion signal.",
        "hypothesis_evaluation": "The hypothesis that combining price-to-EMA deviation with a squared trend stability filter and a 3-day relative volume-weighted range (RVR3) optimizes mean-reversion is partially supported in concept but the current mathematical implementation is suboptimal. The additive nature of the LAPS component (Price Stretch + Volume-Weighted Range) may be creating a signal where the two components cancel each other out or introduce noise, rather than the intended 'liquidity-backed exhaustion' filter.",
        "decision": false,
        "reason": "The current additive formulation treats price stretch and volume-weighted range as independent contributors to the factor value. However, in market microstructure, high volume and range are most significant when they occur *at* the point of price exhaustion. By switching to a multiplicative structure (Deviation * Stability * RVR), we ensure the factor only fires strongly when all three conditions (stretch, stability, and volume climax) align. Additionally, reducing the complexity of the stability filter (removing the square) may improve generalization and reduce potential overfitting indicated by the performance gap between this iteration and SOTA."
      },
      "cache_location": null
    },
    "00cec101f5855bf2": {
      "factor_id": "00cec101f5855bf2",
      "factor_name": "Volatility_Adjusted_Quiet_Trend_20D",
      "factor_expression": "ZSCORE(REGBETA($close, SEQUENCE(20), 20) / (TS_STD(REGRESI($close, SEQUENCE(20), 20), 20) + 1e-8)) + ZSCORE(INV(TS_STD($volume, 20) / (TS_MEAN($volume, 20) + 1e-8)))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"ZSCORE(REGBETA($close, SEQUENCE(20), 20) / (TS_STD(REGRESI($close, SEQUENCE(20), 20), 20) + 1e-8)) + ZSCORE(INV(TS_STD($volume, 20) / (TS_MEAN($volume, 20) + 1e-8)))\" # Your output factor expression will be filled in here\n    name = \"Volatility_Adjusted_Quiet_Trend_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor captures institutional conviction by adjusting the 20-day price slope by its residual volatility and weighting it with a volume stability metric. By using the ratio of mean volume to volume standard deviation, it prioritizes trends backed by steady participation. The final output is a sum of standardized components to ensure robustness.",
      "factor_formulation": "ZSCORE(REGBETA(close, SEQUENCE(20), 20) / (TS_STD(REGRESI(close, SEQUENCE(20), 20), 20) + 1e-8)) + ZSCORE(TS_MEAN(volume, 20) / (TS_STD(volume, 20) + 1e-8))",
      "metadata": {
        "experiment_id": "2026-01-19_15-18-38-517532",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: Institutional trends are best identified by a 20-day Volatility-Adjusted Price Slope modulated by a 20-day 'Quiet Accumulation' index, which uses the inverse of Volume Volatility to prioritize consistent, low-noise liquidity participation.\n                Concise Observation: Previous attempts using Volume-Price Efficiency (VPE) or direct volume scaling failed because raw volume sums and rank-multiplication are too sensitive to outliers, whereas the SOTA's success with Trend Efficiency suggests that risk-normalization is the primary driver of IR.\n                Concise Justification: Using the inverse of the Volume Coefficient of Variation (Mean/STD) as a 'Quiet Accumulation' filter rewards trends with steady participation and penalizes those driven by erratic spikes. Combining this with a Volatility-Adjusted Slope via Z-score addition (rather than rank-multiplication) maintains signal magnitude while improving portfolio-level stability.\n                Concise Knowledge: If a price trend exhibits high volatility-adjusted persistence (Slope/STD) while volume remains stable (low Coefficient of Variation), it indicates institutional accumulation; when volume is erratic or spiking, the trend is more likely speculative or nearing exhaustion.\n                concise Specification: Define Std_Slope_20 as the 20-day linear regression slope of $close divided by the 20-day standard deviation of returns. Define QAI_20 (Quiet Accumulation Index) as the 20-day mean of $volume divided by the 20-day standard deviation of $volume. The final factor is the cross-sectional Z-score of Std_Slope_20 plus the cross-sectional Z-score of QAI_20.\n                ",
        "initial_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "planning_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "created_at": "2026-01-20T03:03:17.481480"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.0952266958268423,
        "ICIR": 0.0482494529815556,
        "1day.excess_return_without_cost.std": 0.0039620198202408,
        "1day.excess_return_with_cost.annualized_return": 0.0287836906238373,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003192447136591,
        "1day.excess_return_without_cost.annualized_return": 0.0759802418508686,
        "1day.excess_return_with_cost.std": 0.0039635029973319,
        "Rank IC": 0.022017853160914,
        "IC": 0.0062696030613854,
        "1day.excess_return_without_cost.max_drawdown": -0.0847099208511729,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.2430698966350249,
        "1day.pa": 0.0,
        "l2.valid": 0.996556585472172,
        "Rank ICIR": 0.1737493087868612,
        "l2.train": 0.9940476124680828,
        "1day.excess_return_with_cost.information_ratio": 0.4707375130662091,
        "1day.excess_return_with_cost.mean": 0.0001209398765707
      },
      "feedback": {
        "observations": "The experiment compared two variations of identifying institutional trends through price-volume synergy. The second factor, 'Volatility_Adjusted_Quiet_Trend_20D', successfully refined the original hypothesis by incorporating residual price volatility (risk-adjusting the slope) and correctly formulating the 'Quiet Accumulation' index as the inverse of the coefficient of variation (Mean/STD). The results show a significant improvement in the Information Ratio (1.243 vs 1.235) and IC (0.00627 vs 0.00597), alongside a substantial reduction in Max Drawdown (-0.0847 vs -0.1147), indicating a much more stable and robust signal.",
        "hypothesis_evaluation": "The results strongly support the hypothesis that institutional trends are best identified by combining price slope with a measure of volume consistency. Specifically, normalizing the price slope by its regression residuals (REGRESI) and using the Mean/STD ratio for volume provides a superior risk-adjusted signal compared to raw slope and raw volume volatility. The improvement in IC and Drawdown suggests that 'quiet' participation is indeed a more reliable predictor of institutional conviction than erratic volume spikes.",
        "decision": true,
        "reason": "While the current SOTA uses the Mean/STD of volume, it treats volume stability in isolation. A 'Volume Efficiency' approach (e.g., Slope / Volume_STD) would directly measure how much price movement is achieved per unit of 'noise' in volume. Furthermore, the current implementation uses Z-score addition; exploring a multiplicative interaction between price conviction and volume stability might create a more non-linear, selective signal that better identifies the 'quiet accumulation' phase before a breakout."
      }
    },
    "8df70874cfbe3c29": {
      "factor_id": "8df70874cfbe3c29",
      "factor_name": "Vol_Adj_Momentum_Convex_VPC_20D",
      "factor_expression": "ZSCORE((TS_SUM($return, 10) / (TS_STD($return, 10) + 1e-8)) * SIGN(TS_CORR($volume, $return, 20)) * POW(TS_CORR($volume, $return, 20), 2))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"ZSCORE((TS_SUM(TS_PCTCHANGE($close, 1), 10) / (TS_STD(TS_PCTCHANGE($close, 1), 10) + 1e-8)) * SIGN(TS_CORR($volume, TS_PCTCHANGE($close, 1), 20)) * POW(TS_CORR($volume, TS_PCTCHANGE($close, 1), 20), 2))\" # Your output factor expression will be filled in here\n    name = \"Vol_Adj_Momentum_Convex_VPC_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor implements a 10-day Volatility-Adjusted Momentum signal, scaled by a non-linear (squared) 20-day Volume-Price Correlation. The 10-day window for price efficiency captures velocity while the squared Spearman correlation (VPC) creates a convex weight that aggressively rewards high synchronization between price and volume, filtering out low-conviction noise.",
      "factor_formulation": "ZSCORE(\\frac{TS\\_SUM(return, 10)}{TS\\_STD(return, 10)} \\times SIGN(TS\\_CORR(volume, return, 20)) \\times POW(TS\\_CORR(volume, return, 20), 2))",
      "metadata": {
        "experiment_id": "2026-01-19_15-18-38-517532",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A 10-day Volatility-Adjusted Momentum signal, scaled by a non-linear (squared) 20-day Volume-Price Correlation, captures high-conviction institutional trends while mitigating the dilution seen in additive or rank-only models.\n                Concise Observation: Previous iterations showed that 20-day windows were too lagging (low returns), while 5-day windows with additive ranks were too dilutive (low IR); furthermore, direct multiplication of raw volume metrics introduced extreme tail risks.\n                Concise Justification: Squaring the Spearman correlation (VPC) creates a convex weight that aggressively rewards high synchronization between price and volume while penalizing weak or divergent relationships more than a linear rank would. A 10-day window for price efficiency serves as a middle ground to capture velocity without the excessive noise of a 5-day lookback.\n                Concise Knowledge: If a momentum signal is normalized by volatility and then amplified by the square of its volume-price correlation, the resulting factor emphasizes high-conviction trends; when the volume filter is non-linear, it effectively suppresses low-synchronization noise without the information loss of binary gates.\n                concise Specification: Define Efficiency_10 as the 10-day price change divided by the 10-day standard deviation of daily returns. Define VPC_20 as the 20-day Spearman correlation between volume and daily returns. The final factor is the cross-sectional Z-score of (Efficiency_10 * sign(VPC_20) * VPC_20^2), ensuring the volume confirmation is non-linearly weighted.\n                ",
        "initial_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "planning_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "created_at": "2026-01-20T00:31:52.689796"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.128078022884104,
        "ICIR": 0.0459497239416117,
        "1day.excess_return_without_cost.std": 0.0044247305577528,
        "1day.excess_return_with_cost.annualized_return": 0.0285207459958802,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003177451327104,
        "1day.excess_return_without_cost.annualized_return": 0.0756233415850859,
        "1day.excess_return_with_cost.std": 0.00442566396651,
        "Rank IC": 0.0251071748226541,
        "IC": 0.0065185058435479,
        "1day.excess_return_without_cost.max_drawdown": -0.1156013674475845,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.107848963074597,
        "1day.pa": 0.0,
        "l2.valid": 0.9963941581442396,
        "Rank ICIR": 0.1820801150397564,
        "l2.train": 0.994135111452872,
        "1day.excess_return_with_cost.information_ratio": 0.4177283655720815,
        "1day.excess_return_with_cost.mean": 0.0001198350672095
      },
      "feedback": {
        "observations": "The current iteration tested three variations of a Volatility-Adjusted Momentum signal scaled by a non-linear (squared) Volume-Price Correlation (VPC). The results show a slight improvement in the Information Coefficient (IC) from 0.005975 to 0.006519, indicating better predictive accuracy at the individual stock level. However, the portfolio-level metrics—Annualized Return (0.0756 vs 0.0831) and Information Ratio (1.1078 vs 1.2349)—show a moderate deterioration compared to the SOTA. This suggests that while the non-linear VPC gating improves the signal-to-noise ratio (IC), the specific convex weighting (squaring the correlation) might be overly aggressive, potentially filtering out profitable trends that have moderate rather than extreme volume confirmation.",
        "hypothesis_evaluation": "The hypothesis that a squared VPC captures high-conviction trends is partially supported by the increased IC. However, the drop in Annualized Return and IR suggests that the 'convex' weighting might be too restrictive or creates a distribution with fat tails that the current model/strategy isn't capturing efficiently. The use of 'SIGN(TS_CORR) * POW(TS_CORR, 2)' effectively preserves the direction of the correlation while emphasizing magnitude; however, the complexity of the formulations (multiple nested functions like ZSCORE, TS_STD, and POW) is approaching the limits of robustness.",
        "decision": false,
        "reason": "The current 'squared' approach creates a very steep penalty for any correlation below 0.8, which may be too 'all-or-nothing'. A Sigmoid or a simple linear scaling of the VPC might retain more of the momentum signal's breadth. Additionally, the 'NonLinear_VPC_Gated_Velocity' factor used TS_PCTCHANGE, which is less stable than TS_MEAN of returns. Moving forward, we should simplify the momentum component to a 10-day Z-score of returns to reduce symbol length and focus on the interaction with volume."
      },
      "cache_location": null
    },
    "422def375d638f33": {
      "factor_id": "422def375d638f33",
      "factor_name": "Short_Term_Force_Efficiency_Rank",
      "factor_expression": "RANK(TS_MEAN($volume * $return, 5) / (TS_STD($volume, 20) / (TS_MEAN($volume, 20) + 1e-6) + 1e-6))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"RANK(TS_MEAN($volume * TS_PCTCHANGE($close, 1), 5) / (TS_STD($volume, 20) / (TS_MEAN($volume, 20) + 1e-6) + 1e-6))\" # Your output factor expression will be filled in here\n    name = \"Short_Term_Force_Efficiency_Rank\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "Calculates the efficiency of price movement per unit of volume volatility by taking the ratio of 5-day average Volume Force to the 20-day coefficient of variation of volume. It prioritizes stocks where recent buying pressure is high and historical volume behavior is stable.",
      "factor_formulation": "\\text{RANK}(\\frac{\\text{TS\\_MEAN}(\\text{volume} \\times \\text{return}, 5)}{\\text{TS\\_STD}(\\text{volume}, 20) / (\\text{TS\\_MEAN}(\\text{volume}, 20) + 1e-6) + 1e-6})",
      "metadata": {
        "experiment_id": "2026-01-19_13-05-39-450069",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A factor that captures the 'Relative Conviction Intensity' by comparing short-term (5-day) Volume Force to long-term (20-day) Volume Force dispersion identifies immediate institutional entry while filtering for historical noise.\n                Concise Observation: Previous attempts using 20-day windows for both numerator and denominator in the 'Volume-Price Synergy' framework resulted in lagging signals and lower returns (0.054 vs 0.075 SOTA), suggesting that the 'conviction' signal needs to be more responsive to recent changes.\n                Concise Justification: Institutional accumulation often starts with a sharp, consistent increase in Volume Force (Volume * Return). By using a 5-day window for the force and a 20-day window for its volatility (dispersion), we create a 'Z-score-like' momentum indicator that highlights statistically significant conviction spikes relative to recent history.\n                Concise Knowledge: If short-term buying/selling pressure (Volume Force) is normalized by the historical standard deviation of that pressure, the signal becomes a scale-invariant measure of 'surprise' conviction; in this scenario, a 5-day numerator versus a 20-day denominator captures timely shifts before they are fully priced in.\n                concise Specification: The factor is defined as: TS_MEAN(Volume * (Close / TS_DELAY(Close, 1) - 1), 5) / (TS_STD(Volume * (Close / TS_DELAY(Close, 1) - 1), 20) + 1e-6). The final factor is the cross-sectional Rank of this ratio, smoothed by a 2-day moving average to maintain timeliness.\n                ",
        "initial_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "planning_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "created_at": "2026-01-19T21:48:02.385785"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1858857957310589,
        "ICIR": 0.0333485696457825,
        "1day.excess_return_without_cost.std": 0.0057088874621369,
        "1day.excess_return_with_cost.annualized_return": 0.0285746807416848,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003206384600035,
        "1day.excess_return_without_cost.annualized_return": 0.076311953480855,
        "1day.excess_return_with_cost.std": 0.0057110406940027,
        "Rank IC": 0.0216574116091178,
        "IC": 0.0054438842648534,
        "1day.excess_return_without_cost.max_drawdown": -0.1364477565980921,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.866468164347276,
        "1day.pa": 0.0,
        "l2.valid": 0.9966299200385982,
        "Rank ICIR": 0.1362182798647692,
        "l2.train": 0.9938408786891096,
        "1day.excess_return_with_cost.information_ratio": 0.3243229290158099,
        "1day.excess_return_with_cost.mean": 0.0001200616837885
      },
      "feedback": {
        "observations": "The current iteration focused on 'Volume Force' (Volume * Return) as a proxy for institutional conviction. Three implementations were tested: a smoothed relative intensity rank, a Z-scored momentum approach, and a volume-efficiency ratio. The results show that while the 'Relative_Conviction_Intensity_5D_20D' factor achieved a slightly higher annualized return (0.0763 vs 0.0755) compared to the SOTA, it suffered from a significantly higher maximum drawdown (-0.1364 vs -0.1064) and a lower Information Ratio (0.866 vs 1.065). The IC also lagged behind the SOTA, suggesting that while the conviction signal captures some alpha, it introduces substantial volatility and noise.",
        "hypothesis_evaluation": "The hypothesis that comparing short-term Volume Force to long-term dispersion identifies institutional entry is partially supported by the improvement in annualized return. However, the degradation in IR and Max Drawdown suggests that 'Volume Force' as defined (Volume * Return) might be too raw and sensitive to daily price swings. The 'Conviction' signal is likely being confounded by high-volatility retail activity rather than pure institutional 'force'. The 20-day dispersion (TS_STD) helps, but the linear interaction of volume and return may be overstating conviction during volatile periods.",
        "decision": true,
        "reason": "The current Volume Force ($volume * $return) is highly sensitive to price gaps and extreme daily moves. By using (Close - Low) / (High - Low) or similar 'Close Location Value' metrics, we can determine if the volume was actually used to support the price at the end of the day (conviction) or if it was just high-volume churn. Furthermore, volume often follows a power-law distribution; log-transforming volume before multiplying by the directional component should create a more stable and less outlier-prone conviction signal, potentially improving the Information Ratio and reducing Drawdown."
      },
      "cache_location": null
    },
    "5b9d671b211fae31": {
      "factor_id": "5b9d671b211fae31",
      "factor_name": "NonLinear_VPC_Gated_Velocity",
      "factor_expression": "ZSCORE((TS_PCTCHANGE($close, 10) / (TS_STD($return, 10) + 1e-8)) * POW(TS_CORR($volume, $return, 20), 2) * SIGN(TS_CORR($volume, $return, 20)))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"ZSCORE((TS_PCTCHANGE($close, 10) / (TS_STD(TS_PCTCHANGE($close, 1), 10) + 1e-8)) * POW(TS_CORR($volume, TS_PCTCHANGE($close, 1), 20), 2) * SIGN(TS_CORR($volume, TS_PCTCHANGE($close, 1), 20)))\" # Your output factor expression will be filled in here\n    name = \"NonLinear_VPC_Gated_Velocity\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor captures early-stage institutional trends by combining a 10-day price velocity with a 20-day non-linear volume-price synchronization gate. By using the square of the correlation, the factor creates a 'convex' reward system for stocks where price moves are most strongly confirmed by volume increases.",
      "factor_formulation": "ZSCORE(\\frac{TS\\_PCTCHANGE(close, 10)}{TS\\_STD(return, 10)} \\times POW(TS\\_CORR(volume, return, 20), 2) \\times SIGN(TS\\_CORR(volume, return, 20)))",
      "metadata": {
        "experiment_id": "2026-01-19_15-18-38-517532",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A 10-day Volatility-Adjusted Momentum signal, scaled by a non-linear (squared) 20-day Volume-Price Correlation, captures high-conviction institutional trends while mitigating the dilution seen in additive or rank-only models.\n                Concise Observation: Previous iterations showed that 20-day windows were too lagging (low returns), while 5-day windows with additive ranks were too dilutive (low IR); furthermore, direct multiplication of raw volume metrics introduced extreme tail risks.\n                Concise Justification: Squaring the Spearman correlation (VPC) creates a convex weight that aggressively rewards high synchronization between price and volume while penalizing weak or divergent relationships more than a linear rank would. A 10-day window for price efficiency serves as a middle ground to capture velocity without the excessive noise of a 5-day lookback.\n                Concise Knowledge: If a momentum signal is normalized by volatility and then amplified by the square of its volume-price correlation, the resulting factor emphasizes high-conviction trends; when the volume filter is non-linear, it effectively suppresses low-synchronization noise without the information loss of binary gates.\n                concise Specification: Define Efficiency_10 as the 10-day price change divided by the 10-day standard deviation of daily returns. Define VPC_20 as the 20-day Spearman correlation between volume and daily returns. The final factor is the cross-sectional Z-score of (Efficiency_10 * sign(VPC_20) * VPC_20^2), ensuring the volume confirmation is non-linearly weighted.\n                ",
        "initial_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "planning_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "created_at": "2026-01-20T00:31:52.689796"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.128078022884104,
        "ICIR": 0.0459497239416117,
        "1day.excess_return_without_cost.std": 0.0044247305577528,
        "1day.excess_return_with_cost.annualized_return": 0.0285207459958802,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003177451327104,
        "1day.excess_return_without_cost.annualized_return": 0.0756233415850859,
        "1day.excess_return_with_cost.std": 0.00442566396651,
        "Rank IC": 0.0251071748226541,
        "IC": 0.0065185058435479,
        "1day.excess_return_without_cost.max_drawdown": -0.1156013674475845,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.107848963074597,
        "1day.pa": 0.0,
        "l2.valid": 0.9963941581442396,
        "Rank ICIR": 0.1820801150397564,
        "l2.train": 0.994135111452872,
        "1day.excess_return_with_cost.information_ratio": 0.4177283655720815,
        "1day.excess_return_with_cost.mean": 0.0001198350672095
      },
      "feedback": {
        "observations": "The current iteration tested three variations of a Volatility-Adjusted Momentum signal scaled by a non-linear (squared) Volume-Price Correlation (VPC). The results show a slight improvement in the Information Coefficient (IC) from 0.005975 to 0.006519, indicating better predictive accuracy at the individual stock level. However, the portfolio-level metrics—Annualized Return (0.0756 vs 0.0831) and Information Ratio (1.1078 vs 1.2349)—show a moderate deterioration compared to the SOTA. This suggests that while the non-linear VPC gating improves the signal-to-noise ratio (IC), the specific convex weighting (squaring the correlation) might be overly aggressive, potentially filtering out profitable trends that have moderate rather than extreme volume confirmation.",
        "hypothesis_evaluation": "The hypothesis that a squared VPC captures high-conviction trends is partially supported by the increased IC. However, the drop in Annualized Return and IR suggests that the 'convex' weighting might be too restrictive or creates a distribution with fat tails that the current model/strategy isn't capturing efficiently. The use of 'SIGN(TS_CORR) * POW(TS_CORR, 2)' effectively preserves the direction of the correlation while emphasizing magnitude; however, the complexity of the formulations (multiple nested functions like ZSCORE, TS_STD, and POW) is approaching the limits of robustness.",
        "decision": false,
        "reason": "The current 'squared' approach creates a very steep penalty for any correlation below 0.8, which may be too 'all-or-nothing'. A Sigmoid or a simple linear scaling of the VPC might retain more of the momentum signal's breadth. Additionally, the 'NonLinear_VPC_Gated_Velocity' factor used TS_PCTCHANGE, which is less stable than TS_MEAN of returns. Moving forward, we should simplify the momentum component to a 10-day Z-score of returns to reduce symbol length and focus on the interaction with volume."
      },
      "cache_location": null
    },
    "1e95d618e4484f67": {
      "factor_id": "1e95d618e4484f67",
      "factor_name": "Institutional_Conviction_Efficiency_Z",
      "factor_expression": "ZSCORE(TS_PCTCHANGE($close, 10) / (TS_MEAN(TS_ZSCORE($volume, 20), 10) + 2.0))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"ZSCORE(TS_PCTCHANGE($close, 10) / (TS_MEAN(TS_ZSCORE($volume, 20), 10) + 2.0))\" # Your output factor expression will be filled in here\n    name = \"Institutional_Conviction_Efficiency_Z\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A refined version of price efficiency that uses Z-score normalization to compare 10-day price returns against standardized volume intensity. It identifies assets where price trends are achieved with minimal resistance, filtering out high-churn speculative noise.",
      "factor_formulation": "ICE = \\text{ZSCORE}\\left(\\frac{\\text{TS_PCTCHANGE}(close, 10)}{\\text{TS_MEAN}(\\text{TS_ZSCORE}(volume, 20), 10) + 2.0}\\right)",
      "metadata": {
        "experiment_id": "2026-01-19_13-05-39-450069",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A factor measuring the 'Volume-Weighted Price Efficiency' (VWPE) by calculating the ratio of cumulative price displacement to cumulative volume intensity over a 10-day window identifies high-conviction trends while filtering out high-churn speculative noise.\n                Concise Observation: Previous attempts using Volume Force (Vol * Ret) or CLV-based measures failed because they were either too sensitive to daily price gaps or too lagging; the 'Refined Conviction' failed because it ignored the efficiency of price movement relative to the effort (volume) expended.\n                Concise Justification: Normalizing the 10-day price return by the 10-day average volume Z-score creates an efficiency metric. High efficiency suggests that the market is moving with minimal resistance (institutional conviction), while low efficiency identifies 'churn' where high volume fails to move the price, often preceding reversals.\n                Concise Knowledge: If price displacement is achieved with relatively low volume intensity, the trend is more 'efficient' and likely institutional; when high volume results in little price movement (high churn), the signal indicates speculative exhaustion or distribution in physics-based instrument data.\n                concise Specification: The factor is defined as: TS_PCTCHANGE($close, 10) / (TS_MEAN(($volume - TS_MEAN($volume, 20)) / (TS_STD($volume, 20) + 1e-6), 10) + 2.0). The '+2.0' in the denominator acts as a stabilization constant to prevent division by zero and dampen the signal for extremely low-volume assets. The final output is cross-sectionally ranked.\n                ",
        "initial_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "planning_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "created_at": "2026-01-19T21:56:40.105324"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1752565298555117,
        "ICIR": 0.0451498604304608,
        "1day.excess_return_without_cost.std": 0.0056880967544515,
        "1day.excess_return_with_cost.annualized_return": 0.0276089778533868,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0003156380015927,
        "1day.excess_return_without_cost.annualized_return": 0.075121844379083,
        "1day.excess_return_with_cost.std": 0.0056909774098246,
        "Rank IC": 0.0247395902213113,
        "IC": 0.0072211089014496,
        "1day.excess_return_without_cost.max_drawdown": -0.1279408401650622,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.8560729774597977,
        "1day.pa": 0.0,
        "l2.valid": 0.996611903689488,
        "Rank ICIR": 0.1578248825694491,
        "l2.train": 0.994282823794645,
        "1day.excess_return_with_cost.information_ratio": 0.3144669352779266,
        "1day.excess_return_with_cost.mean": 0.0001160041086276
      },
      "feedback": {
        "observations": "The experimental results for the 'Volume-Weighted Price Efficiency' (VWPE) framework show promising predictive power. The current iteration achieved a significantly higher Information Coefficient (IC) of 0.0072 compared to the SOTA's 0.0054, indicating a stronger linear relationship between the factor and future returns. However, while the risk-adjusted performance (Max Drawdown) improved, the Annualized Return (0.0751) and Information Ratio (0.8561) slightly lagged behind the previous SOTA (0.0763 and 0.8665, respectively). The implementation of 'Volume_Intensity_Adjusted_Return_10D' and 'Institutional_Conviction_Efficiency_Z' suggests that normalizing volume intensity is a valid approach to identifying high-conviction trends, though the current scaling constants (e.g., +2.0 or +1.0) may be dampening the signal's sensitivity too much.",
        "hypothesis_evaluation": "The hypothesis that price displacement relative to volume intensity identifies high-conviction trends is supported by the significant improvement in IC. The results suggest that assets achieving price gains with lower relative volume (high efficiency) tend to have better forward-looking performance. However, the slight dip in annualized return compared to the SOTA suggests that the current mathematical representations (linear ratios with additive constants) might be capturing some noise or failing to capture the non-linear relationship between extreme volume spikes and price reversals.",
        "decision": false,
        "reason": "The current factors use a simple ratio of returns to volume intensity. By explicitly focusing on the sign of the return and using a square root or logarithmic transformation on the volume intensity, we can reduce the impact of extreme volume outliers (which often occur at trend exhaustion) while maintaining a high signal-to-noise ratio for steady, efficient price trends. The current additive constants (1.0, 2.0) are arbitrary; a more robust approach would be to use the cross-sectional median of volume intensity to ensure the denominator is always well-behaved without over-dampening the signal."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260119_210539",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210539",
        "factor_dir": "e0d1073513eb481d89408a3e7c2af2b0",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210539/e0d1073513eb481d89408a3e7c2af2b0/result.h5"
      }
    },
    "ee3f15b75b09261e": {
      "factor_id": "ee3f15b75b09261e",
      "factor_name": "EWSD_Exhaustion_ZScore_5D",
      "factor_expression": "( (MIN($open, $close) - $low) / ($high - $low + 1e-6) ) * ($volume / (TS_MEAN($volume, 5) + 1e-8)) * ( ((($close - TS_MEAN($close, 5)) / (TS_STD($close, 5) + 1e-6)) < -1) ? ABS(($close - TS_MEAN($close, 5)) / (TS_STD($close, 5) + 1e-6)) : 0 )",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"( (MIN($open, $close) - $low) / ($high - $low + 1e-6) ) * ($volume / (TS_MEAN($volume, 5) + 1e-8)) * ( ((($close - TS_MEAN($close, 5)) / (TS_STD($close, 5) + 1e-6)) < -1) ? ABS(($close - TS_MEAN($close, 5)) / (TS_STD($close, 5) + 1e-6)) : 0 )\" # Your output factor expression will be filled in here\n    name = \"EWSD_Exhaustion_ZScore_5D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "Exhaustion-Weighted Shadow Dominance (EWSD): This factor identifies short-term reversals by measuring intraday buying support (lower shadow dominance) on high relative volume, amplified only when the price is significantly oversold (Z-score < -1) relative to its 5-day moving average. The Z-score acts as a volatility-adjusted exhaustion filter.",
      "factor_formulation": "SD = \\frac{\\min(open, close) - low}{(high - low) + 1e-6}, VS = \\frac{volume}{TS\\_MEAN(volume, 5)}, Z = \\frac{close - TS\\_MEAN(close, 5)}{TS\\_STD(close, 5) + 1e-6}, Factor = SD \\times VS \\times (Z < -1 ? ABS(Z) : 0)",
      "metadata": {
        "experiment_id": "2026-01-19_13-05-20-154982",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: Short-term reversals are driven by 'Exhaustion-Weighted Shadow Dominance' (EWSD), where the Volume-Weighted Shadow Dominance (VWSD) is non-linearly amplified by the degree of price extension below a 5-day moving average, normalized by the 5-day standard deviation.\n                Concise Observation: While VWSD improved the Information Coefficient (IC), the deterioration in Information Ratio (IR) and drawdown suggests the signal triggers in non-extreme price levels where mean reversion is weak; simple 3-day returns or ranks fail to distinguish between a healthy pullback and a true exhaustion point.\n                Concise Justification: By replacing the simple momentum multiplier with a Z-score (price relative to its 5-day moving average divided by 5-day standard deviation), we normalize the 'oversold' condition across different volatility regimes, ensuring that the shadow dominance signal is only amplified when the price is significantly extended from its recent equilibrium.\n                Concise Knowledge: If a stock exhibits strong intraday buying support (lower shadow dominance) on high volume while trading at a significant negative Z-score relative to its short-term mean, the probability of a reversal is higher; the Z-score acts as a volatility-adjusted exhaustion filter that outperforms simple momentum or binary filters.\n                concise Specification: 1. LS = min(open, close) - low; 2. US = high - max(open, close); 3. SD = LS / (LS + US + 1e-6); 4. VS = volume / mean(volume, 5); 5. Z_Score = (close - mean(close, 5)) / (std(close, 5) + 1e-6); 6. Factor = SD * VS * (Z_Score < -1 ? abs(Z_Score) : 0). Use a 5-day window for mean and standard deviation to capture short-term exhaustion.\n                ",
        "initial_direction": "参考以下组合给出假设。组合3包含RESI5（表达式：Resi(, 5)/，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less(, )-)/，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std(, 5)/，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "planning_direction": "参考以下组合给出假设。组合3包含RESI5（表达式：Resi(, 5)/，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less(, )-)/，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std(, 5)/，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "created_at": "2026-01-19T21:43:17.571264"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.09686166305869,
        "ICIR": 0.0561789985312876,
        "1day.excess_return_without_cost.std": 0.0045985435918715,
        "1day.excess_return_with_cost.annualized_return": 0.0096240355041287,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002399967024826,
        "1day.excess_return_without_cost.annualized_return": 0.0571192151908734,
        "1day.excess_return_with_cost.std": 0.0045998758505915,
        "Rank IC": 0.0230284109397066,
        "IC": 0.008502453034096,
        "1day.excess_return_without_cost.max_drawdown": -0.0872655661341231,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.8051437859270764,
        "1day.pa": 0.0,
        "l2.valid": 0.9964140520495935,
        "Rank ICIR": 0.1521385507914535,
        "l2.train": 0.991513425611256,
        "1day.excess_return_with_cost.information_ratio": 0.1356196526167619,
        "1day.excess_return_with_cost.mean": 4.0437123966927705e-05
      },
      "feedback": {
        "observations": "The current iteration focused on refining the 'Exhaustion-Weighted Shadow Dominance' (EWSD) hypothesis by testing hard thresholds versus continuous mappings and cross-sectional ranking. The results show a significant improvement in the Information Coefficient (IC), rising from 0.0052 to 0.0085, and a notable reduction in Max Drawdown (-0.087 vs -0.110). However, the Annualized Return and Information Ratio (IR) have slightly decreased compared to the SOTA. This suggests that while the current factors (likely the 'Continuous_EWSD_Stabilized') have better predictive power for the general universe (higher IC), the previous SOTA was more effective at capturing the top-tier alpha for the long-short portfolio construction.",
        "hypothesis_evaluation": "The hypothesis that price exhaustion (Z-score) amplifies the signal of shadow dominance is strongly supported by the improved IC and lower drawdown. The 'Continuous_EWSD_Stabilized' approach likely contributed to the IC gain by providing a smoother signal across more instruments. However, the drop in annualized return suggests that the non-linear 'amplification' might be diluting the signal strength of the most extreme reversal candidates. The trade-off between a robust continuous signal and a concentrated threshold-based signal needs to be balanced.",
        "decision": false,
        "reason": "1. Using a simple volume mean doesn't account for the 'cost' of the shadow (volatility); normalizing volume by ATR or using 'Relative Volume' relative to volatility can isolate true exhaustion. 2. To recover the Annualized Return lost in the continuous version, applying a power function (e.g., MAX(0, -Z)^2) will maintain the continuous nature while restoring the emphasis on the 'tails' (extreme exhaustion) which often drive the highest excess returns. 3. The current complexity is low (ER < 6, PC is minimal), allowing room for these more refined mathematical expressions without risking overfitting."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260119_210519",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210519",
        "factor_dir": "e8e0c4207eb1414d93f9f1b949a9307d",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210519/e8e0c4207eb1414d93f9f1b949a9307d/result.h5"
      }
    },
    "eef3e53cde5dfacc": {
      "factor_id": "eef3e53cde5dfacc",
      "factor_name": "PVE_Multiplicative_Conviction_20D",
      "factor_expression": "ZSCORE(REGBETA($close, SEQUENCE(20), 20) * ABS(REGBETA($close, SEQUENCE(20), 20) / (TS_STD($volume, 20) + 1e-8)))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"ZSCORE(REGBETA($close, SEQUENCE(20), 20) * ABS(REGBETA($close, SEQUENCE(20), 20) / (TS_STD($volume, 20) + 1e-8)))\" # Your output factor expression will be filled in here\n    name = \"PVE_Multiplicative_Conviction_20D\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor captures institutional conviction by multiplying a 20-day price velocity (regression slope) with a Price-Volume Efficiency (PVE) metric. The PVE is defined as the absolute price movement relative to volume volatility. By using a multiplicative approach, the factor selectively amplifies trends where price displacement is high and volume noise is low, identifying efficient 'quiet accumulation'.",
      "factor_formulation": "ZSCORE(REGBETA(close, SEQUENCE(20), 20) * ABS(REGBETA(close, SEQUENCE(20), 20) / (TS_STD(volume, 20) + 1e-8)))",
      "metadata": {
        "experiment_id": "2026-01-19_15-18-38-517532",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A 20-day Volatility-Adjusted Price Slope, when non-linearly modulated by a 20-day Price-Volume Efficiency (PVE) ratio (Slope / Volume Standard Deviation), captures institutional conviction by identifying significant price displacement achieved with minimal volume noise.\n                Concise Observation: Hypothesis 10 succeeded (IR 1.24, MDD -0.08) by using Volume Consistency (Mean/STD) as an additive component, proving that volume stability is a powerful risk-reducer. However, the additive Z-score approach treats price and volume as independent contributors, potentially missing the synergistic 'efficiency' of how volume actually drives price.\n                Concise Justification: The 'Volume Efficiency' (Slope / Volume_STD) directly measures the price impact per unit of volume uncertainty. A multiplicative interaction between the Volatility-Adjusted Slope and this Efficiency metric creates a more selective, non-linear signal that amplifies only those trends where price direction and volume stability are perfectly synchronized, filtering out high-volume 'noise' more aggressively than an additive model.\n                Concise Knowledge: If price velocity is normalized by return volatility to ensure trend quality, and then multiplied by a volume-efficiency metric (Slope/Vol_STD), the signal isolates institutional 'quiet accumulation'; when price moves significantly despite low volume variance, it indicates a lack of resistance and high conviction, whereas high volume variance suggests speculative churn.\n                concise Specification: Define Std_Slope_20 as the 20-day linear regression slope of $close divided by the 20-day standard deviation of returns. Define PVE_20 as the 20-day linear regression slope of $close divided by the 20-day standard deviation of $volume. The final factor is the cross-sectional Z-score of (Std_Slope_20 * ABS(PVE_20)), preserving the direction of the slope while scaling by the magnitude of volume efficiency.\n                ",
        "initial_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "planning_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare(, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：(-)/，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs(/Ref(, 1)-1)*, 5)/(Mean(Abs(/Ref(, 1)-1)*, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。",
        "created_at": "2026-01-20T03:15:59.462533"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1436204246200835,
        "ICIR": 0.0533645653023811,
        "1day.excess_return_without_cost.std": 0.0047609032685614,
        "1day.excess_return_with_cost.annualized_return": -0.0064845374416114,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0001708972947033,
        "1day.excess_return_without_cost.annualized_return": 0.0406735561394015,
        "1day.excess_return_with_cost.std": 0.0047617213687036,
        "Rank IC": 0.0229503388112437,
        "IC": 0.0075278152373577,
        "1day.excess_return_without_cost.max_drawdown": -0.1144280895808967,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.5537762280062983,
        "1day.pa": 0.0,
        "l2.valid": 0.9962635963999829,
        "Rank ICIR": 0.167137183569045,
        "l2.train": 0.9938999225224068,
        "1day.excess_return_with_cost.information_ratio": -0.0882727272282681,
        "1day.excess_return_with_cost.mean": -2.7245955637022712e-05
      },
      "feedback": {
        "observations": "The current iteration focused on the 'Price-Volume Efficiency (PVE)' framework, testing three variations: a multiplicative conviction model, a simple efficiency-weighted slope, and a triple-normalized synergy model. While the current results achieved a higher Information Coefficient (IC: 0.0075 vs SOTA: 0.0063), the risk-adjusted returns (Information Ratio) and absolute Annualized Return significantly underperformed the SOTA. This suggests that while the PVE signals have higher raw predictive correlation (IC), they likely suffer from higher volatility or poor tail performance, leading to a lower IR (0.55 vs 1.24) and deeper Max Drawdown (-0.11 vs -0.08).",
        "hypothesis_evaluation": "The hypothesis that PVE captures institutional conviction is partially supported by the improved IC, indicating that the 'price displacement per unit of volume noise' is a valid signal. However, the multiplicative approach in 'PVE_Multiplicative_Conviction_20D' might be overly aggressive, amplifying outliers. The 'Volatility_Adjusted_PVE_Synergy_20D' factor introduces more complexity ($return, $close, $volume) which may be diluting the signal's purity. The core concept of efficiency is strong, but the current mathematical implementations are not yet translating into superior risk-adjusted returns.",
        "decision": false,
        "reason": "The current factors use cross-sectional normalization (ZSCORE/RANK) on raw ratios, which ignores the fact that different stocks have different baseline volume volatilities. A stock with naturally high volume variance will always appear 'inefficient' in the current model. By using a self-relative 'Efficiency Surge' ratio, we can identify when a specific instrument is becoming significantly more efficient than its own norm, which is a stronger proxy for new institutional entry. This also simplifies the factor by focusing on the change in efficiency rather than complex triple-normalization."
      }
    },
    "286c951a5871771a": {
      "factor_id": "286c951a5871771a",
      "factor_name": "Stable_Recovery_Momentum_Z",
      "factor_expression": "ZSCORE(TS_PCTCHANGE($close, 60)) + ZSCORE(TS_CORR($close, $volume, 20)) - ZSCORE(TS_STD($volume, 5))",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"ZSCORE(TS_PCTCHANGE($close, 60)) + ZSCORE(TS_CORR($close, $volume, 20)) - ZSCORE(TS_STD($volume, 5))\" # Your output factor expression will be filled in here\n    name = \"Stable_Recovery_Momentum_Z\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "A cross-sectionally standardized version of the trend-liquidity hypothesis. It targets mean-reversion by focusing on assets with low price ratios (oversold), high price-volume alignment, and low volume noise to ensure the recovery is driven by steady institutional accumulation.",
      "factor_formulation": "\\text{ZSCORE}(\\text{TS_PCTCHANGE}(\\text{close}, 60)) + \\text{ZSCORE}(\\text{TS_CORR}(\\text{close}, \\text{volume}, 20)) - \\text{ZSCORE}(\\text{TS_STD}(\\text{volume}, 5))",
      "metadata": {
        "experiment_id": "2026-01-19_13-05-39-450069",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: A composite factor combining long-term price momentum (ROC60), price-volume correlation (CORR20), and short-term volume volatility (VSTD5) can effectively predict asset returns by identifying stocks with stable liquidity and significant trend reversals.\n                Concise Observation: Market participants often react to long-term price trends, but the reliability of these trends is heavily influenced by the underlying volume structure and the consistency of liquidity as measured by volume standard deviation.\n                Concise Justification: ROC60 captures the mean-reversion potential of oversold assets, CORR20 identifies whether price movements are supported by volume (liquidity confirmation), and VSTD5 filters for assets with steady institutional interest rather than erratic speculative spikes.\n                Concise Knowledge: If a stock exhibits a low 60-day price ratio (long-term decline) combined with a positive price-volume correlation and low volume volatility, it is more likely to experience a mean-reverting recovery; conversely, high volume volatility suggests unstable capital flows.\n                concise Specification: The factor is defined as the product of ROC60 (Price_t-60 / Price_t), the 20-day correlation between Close and Log(Volume+1), and the inverse of the 5-day Volume Standard Deviation, applied cross-sectionally.\n                ",
        "initial_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "planning_direction": "参考以下组合给出假设。组合2包含ROC60（表达式：Ref(, 60)/，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr(, Log(+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std(, 5)/(+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。",
        "created_at": "2026-01-19T21:15:12.186373"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1738291410528238,
        "ICIR": 0.0332235529304159,
        "1day.excess_return_without_cost.std": 0.0050952451490776,
        "1day.excess_return_with_cost.annualized_return": 0.0079247219321142,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.000233449136343,
        "1day.excess_return_without_cost.annualized_return": 0.0555608944496491,
        "1day.excess_return_with_cost.std": 0.0050972896486133,
        "Rank IC": 0.0226566225829021,
        "IC": 0.0050509790134663,
        "1day.excess_return_without_cost.max_drawdown": -0.124708977803598,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.7068311261268861,
        "1day.pa": 0.0,
        "l2.valid": 0.9968939749013248,
        "Rank ICIR": 0.1522691582364969,
        "l2.train": 0.9941969362853708,
        "1day.excess_return_with_cost.information_ratio": 0.1007757969160998,
        "1day.excess_return_with_cost.mean": 3.329715097526994e-05
      },
      "feedback": {
        "observations": "The experiment tested three variations of a composite factor combining long-term price momentum, price-volume correlation, and volume volatility. The 'Current Result' (representing the best of the newly implemented factors) achieved a higher annualized return (0.055561 vs 0.052010) compared to the SOTA, but showed a significant deterioration in the Information Ratio (0.706831 vs 0.972561) and Max Drawdown (-0.124709 vs -0.072585). The IC also slightly decreased. This suggests that while the current implementation captures higher raw alpha, it does so with significantly higher volatility and risk, likely due to the aggressive nature of the 'Volume_Confirmed_Reversal_Filter' or the multiplicative structure of the 'Composite_Trend_Liquidity_Factor'.",
        "hypothesis_evaluation": "The hypothesis that combining long-term momentum with price-volume correlation and volume stability can predict returns is supported by the improvement in annualized return. However, the current implementation lacks robustness, as evidenced by the high drawdown and lower Information Ratio. The 'reversal' aspect (using close_t-60 / close_t) seems to introduce significant noise. The transition from rank-based multiplication to Z-score addition in 'Stable_Recovery_Momentum_Z' was a step toward better risk control, but still hasn't surpassed the SOTA's risk-adjusted performance.",
        "decision": true,
        "reason": "The current factors use TS_STD(volume, 5), which might be too sensitive to short-term noise. Replacing this with a ratio of short-term volume to long-term average volume (e.g., volume_5d / volume_20d) can better identify 'quiet' accumulation versus 'erratic' spikes. Furthermore, using a divergence measure (e.g., the difference between price rank and volume rank) rather than correlation may more accurately capture the 'confirmation' logic while maintaining a lower symbol length and fewer free parameters, addressing potential complexity issues before they arise."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260119_210539",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210539",
        "factor_dir": "57f13467e2864d1096c71715079442a9",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_210539/57f13467e2864d1096c71715079442a9/result.h5"
      }
    },
    "dca33d5d4b49583e": {
      "factor_id": "dca33d5d4b49583e",
      "factor_name": "EMA_Deviation_Stability_LAPS_Factor",
      "factor_expression": "(($close / (EMA($close, 5) + 1e-8) - 1) * POW(TS_CORR($close, SEQUENCE(10), 10), 2)) + TS_MEAN((($high - $low) / ($close + 1e-8)) * ($volume / (TS_MEAN($volume, 10) + 1e-8)), 3)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"(($close / (EMA($close, 5) + 1e-8) - 1) * POW(TS_CORR($close, SEQUENCE(10), 10), 2)) + TS_MEAN((($high - $low) / ($close + 1e-8)) * ($volume / (TS_MEAN($volume, 10) + 1e-8)), 3)\" # Your output factor expression will be filled in here\n    name = \"EMA_Deviation_Stability_LAPS_Factor\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor captures mean-reversion opportunities by combining the price deviation from a 5-day EMA with a squared 10-day trend stability filter. To avoid duplication and improve robustness, it uses a 'Liquidity-Adjusted Price Stretch' (LAPS) which measures the 3-day average range relative to price, scaled by a 10-day volume ratio, ensuring the reversal is backed by significant price movement and volume.",
      "factor_formulation": "LAPS = \\left( \\frac{close}{EMA(close, 5)} - 1 \\right) \\cdot TS\\_CORR(close, SEQUENCE(10), 10)^2 + TS\\_MEAN\\left( \\frac{high - low}{close + 1e-8} \\cdot \\frac{volume}{TS\\_MEAN(volume, 10) + 1e-8}, 3 \\right)",
      "metadata": {
        "experiment_id": "2026-01-19_08-47-26-074588",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: The mean-reversion signal is optimized by combining a 5-day price-to-EMA deviation with a squared 10-day trend stability filter (RSQR10^2) and a 3-day relative volume-weighted range (RVR3) to identify liquidity-backed exhaustion.\n                Concise Observation: Previous attempts using complex Z-scores of intraday shadows (Z-VWKLOW3) failed to improve performance, likely due to over-parameterization and noise in the shadow calculation, whereas the squared RSQR filter has consistently proven effective at reducing 'falling knife' risks.\n                Concise Justification: The failure of Hypothesis 7 suggests that the triple-nested Z-score of shadows was too noisy. By replacing it with a simpler Relative Volume-weighted Range (RVR), we capture the same 'exhaustion' logic (high volume + wide range) with fewer parameters. Using EMA(5) instead of SMA(5) maintains sensitivity to recent price turns while the squared RSQR ensures we only trade in mature, stable trends.\n                Concise Knowledge: If a price deviation is measured against an EMA and filtered by squared trend stability, it captures high-conviction reversals; when this is combined with a volume-weighted range relative to its recent average, it identifies 'liquidity climaxes' where high trading activity at price extremes signals a turning point in this physics-value instrument data.\n                concise Specification: The factor is defined as: ((CLOSE / EMA(CLOSE, 5) - 1) * (RSQR10^2)) + SMA(((HIGH - LOW) / CLOSE) * (VOLUME / SMA(VOLUME, 10)), 3). RSQR10 is the 10-day R-squared of the close price; the second term is the 3-day average of the daily range (high-low) normalized by close and scaled by the 10-day relative volume ratio.\n                ",
        "initial_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare($close, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：($high-$low)/$open，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs($close/Ref($close, 1)-1)*$volume, 5)/(Mean(Abs($close/Ref($close, 1)-1)*$volume, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。组合2包含ROC60（表达式：Ref($close, 60)/$close，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr($close, Log($volume+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std($volume, 5)/($volume+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。组合3包含RESI5（表达式：Resi($close, 5)/$close，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less($open, $close)-$low)/$open，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std($close, 5)/$close，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "planning_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare($close, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：($high-$low)/$open，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs($close/Ref($close, 1)-1)*$volume, 5)/(Mean(Abs($close/Ref($close, 1)-1)*$volume, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。组合2包含ROC60（表达式：Ref($close, 60)/$close，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr($close, Log($volume+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std($volume, 5)/($volume+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。组合3包含RESI5（表达式：Resi($close, 5)/$close，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less($open, $close)-$low)/$open，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std($close, 5)/$close，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "created_at": "2026-01-19T18:40:11.378335"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1152239564012357,
        "ICIR": 0.0501259795564825,
        "1day.excess_return_without_cost.std": 0.004379605886936,
        "1day.excess_return_with_cost.annualized_return": 0.0153756678778558,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0002630712728567,
        "1day.excess_return_without_cost.annualized_return": 0.062610962939904,
        "1day.excess_return_with_cost.std": 0.0043815246865,
        "Rank IC": 0.0259790713607474,
        "IC": 0.0071298931397198,
        "1day.excess_return_without_cost.max_drawdown": -0.1056704303258209,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 0.9266737775171104,
        "1day.pa": 0.0,
        "l2.valid": 0.9963477327659104,
        "Rank ICIR": 0.1878333356451531,
        "l2.train": 0.9943507490495196,
        "1day.excess_return_with_cost.information_ratio": 0.2274679679709574,
        "1day.excess_return_with_cost.mean": 6.460364654561298e-05
      },
      "feedback": {
        "observations": "The experiment tested the 'EMA_Deviation_Stability_LAPS_Factor', which implements a mean-reversion logic combined with trend stability and a liquidity-weighted range. While the factor logic is theoretically sound, the performance metrics (Annualized Return: 0.0626, IR: 0.9267, IC: 0.0071) significantly underperform compared to the SOTA results (Annualized Return: 0.1057, IR: 1.5351, IC: 0.0074). The Max Drawdown is also deeper than the SOTA. The current implementation uses a complex additive structure between price deviation and volume-weighted range, which might be diluting the primary mean-reversion signal.",
        "hypothesis_evaluation": "The hypothesis that combining price-to-EMA deviation with a squared trend stability filter and a 3-day relative volume-weighted range (RVR3) optimizes mean-reversion is partially supported in concept but the current mathematical implementation is suboptimal. The additive nature of the LAPS component (Price Stretch + Volume-Weighted Range) may be creating a signal where the two components cancel each other out or introduce noise, rather than the intended 'liquidity-backed exhaustion' filter.",
        "decision": false,
        "reason": "The current additive formulation treats price stretch and volume-weighted range as independent contributors to the factor value. However, in market microstructure, high volume and range are most significant when they occur *at* the point of price exhaustion. By switching to a multiplicative structure (Deviation * Stability * RVR), we ensure the factor only fires strongly when all three conditions (stretch, stability, and volume climax) align. Additionally, reducing the complexity of the stability filter (removing the square) may improve generalization and reduce potential overfitting indicated by the performance gap between this iteration and SOTA."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260119_164725",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_164725",
        "factor_dir": "37d3029c7ac24ed6bde86eb35c8e9da0",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_164725/37d3029c7ac24ed6bde86eb35c8e9da0/result.h5"
      }
    },
    "ab276d190cab72ea": {
      "factor_id": "ab276d190cab72ea",
      "factor_name": "VW_Mean_Reversion_Stability_Factor",
      "factor_expression": "(($close / (TS_MEAN($close, 5) + 1e-8) - 1) * POW(TS_CORR($close, SEQUENCE(10), 10), 2)) + TS_MEAN((($open - $low) / ($open + 1e-8)) * ($volume / (TS_MEAN($volume, 10) + 1e-8)), 3)",
      "factor_implementation_code": "File: factor.py\n\nimport pandas as pd\nimport numpy as np\nimport os\nfrom alphaagent.components.coder.factor_coder.expr_parser import parse_expression, parse_symbol\nfrom alphaagent.components.coder.factor_coder.function_lib import *\n\n\ndef calculate_factor(expr: str, name: str):\n    # stock dataframe\n    df = pd.read_hdf('./daily_pv.h5', key='data')\n    \n    expr = parse_symbol(expr, df.columns)\n    expr = parse_expression(expr)\n\n    # replace '$var' by 'df['var'] to extract var's actual values\n    for col in df.columns:\n        expr = expr.replace(col[1:], f\"df[\\'{col}\\']\")\n\n    df[name] = eval(expr)\n    result = df[name].astype(np.float64)\n\n    if os.path.exists('result.h5'):\n        os.remove('result.h5')\n    result.to_hdf('result.h5', key='data')\n\nif __name__ == '__main__':\n    # Input factor expression. Do NOT use the variable format like \"df['$xxx']\" in factor expressions. Instead, you should use \"$xxx\". \n    expr = \"(($close / (TS_MEAN($close, 5) + 1e-8) - 1) * POW(TS_CORR($close, SEQUENCE(10), 10), 2)) + TS_MEAN((($open - $low) / ($open + 1e-8)) * ($volume / (TS_MEAN($volume, 10) + 1e-8)), 3)\" # Your output factor expression will be filled in here\n    name = \"VW_Mean_Reversion_Stability_Factor\" # Your output factor name will be filled in here\n    calculate_factor(expr, name)\n",
      "factor_description": "This factor combines a 5-day price-to-moving-average deviation (PMA5) with a squared 10-day trend stability metric (RSQR10) to penalize unstable regimes. It is further enhanced by a 3-day volume-weighted lower shadow (VW_KLOW3) which confirms liquidity support during price dips.",
      "factor_formulation": "\\left( \\left( \\frac{close}{SMA(close, 5)} - 1 \\right) \\times TS\\_CORR(close, SEQUENCE(10), 10)^2 \\right) + SMA\\left( \\frac{open - low}{open} \\times \\frac{volume}{SMA(volume, 10)}, 3 \\right)",
      "metadata": {
        "experiment_id": "2026-01-19_08-47-26-074588",
        "round_number": 0,
        "evolution_phase": "original",
        "trajectory_id": "",
        "parent_trajectory_ids": [],
        "hypothesis": "Hypothesis: The mean-reversion signal is optimized by combining a 5-day price-to-moving-average deviation (PMA5) with a 10-day trend stability filter (RSQR10) through a non-linear interaction that penalizes low-stability regimes while using a 3-day volume-weighted lower shadow (VW_KLOW3) to confirm liquidity support.\n                Concise Observation: Previous attempts showed that while price-to-moving-average (PMA) improved IC, binary thresholds for RSQR were too restrictive, and simple additive KLOW components failed to account for the significance of the liquidity behind the intraday support.\n                Concise Justification: Squaring the RSQR10 term acts as a soft-gate that aggressively dampens signals in unstable regimes without the information loss of a hard cutoff. Weighting the lower shadow (KLOW) by relative volume ensures that the 'support' identified is a result of active market participation, which is a more robust indicator of a price floor.\n                Concise Knowledge: If a mean-reversion signal is combined with trend stability, a non-linear scaling (e.g., squaring the stability metric) is more effective than a binary threshold for preserving signal depth while suppressing noise; in this physics-value context, weighting intraday support by volume (VW_KLOW) better distinguishes between technical 'dips' and illiquid price gaps.\n                concise Specification: The factor is defined as: ( (CLOSE / SMA(CLOSE, 5) - 1) * (RSQR10^2) ) + SMA(((OPEN - LOW) / OPEN) * (VOLUME / SMA(VOLUME, 10)), 3). RSQR10 is the 10-day R-squared of the close price; the second term is the 3-day average of the volume-weighted lower shadow ratio.\n                ",
        "initial_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare($close, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：($high-$low)/$open，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs($close/Ref($close, 1)-1)*$volume, 5)/(Mean(Abs($close/Ref($close, 1)-1)*$volume, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。组合2包含ROC60（表达式：Ref($close, 60)/$close，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr($close, Log($volume+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std($volume, 5)/($volume+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。组合3包含RESI5（表达式：Resi($close, 5)/$close，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less($open, $close)-$low)/$open，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std($close, 5)/$close，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "planning_direction": "参考以下组合给出假设。组合1包含RSQR10（表达式：Rsquare($close, 10)，含义：10日价格线性回归R²，反映中期趋势稳定性）、KLEN（表达式：($high-$low)/$open，含义：日内K线总长度，衡量价格波动幅度）、WVMA5（表达式：Std(Abs($close/Ref($close, 1)-1)*$volume, 5)/(Mean(Abs($close/Ref($close, 1)-1)*$volume, 5)+1e-12)，含义：5日成交量加权价格波动率，反映量价共振）。组合2包含ROC60（表达式：Ref($close, 60)/$close，含义：60日价格反转因子，值>1表示长期下跌）、CORR20（表达式：Corr($close, Log($volume+1), 20)，含义：20日收盘价与成交量对数的相关系数）、VSTD5（表达式：Std($volume, 5)/($volume+1e-12)，含义：5日成交量标准差，反映资金流向稳定性）。组合3包含RESI5（表达式：Resi($close, 5)/$close，含义：5日线性回归残差，反映价格偏离趋势程度）、KLOW（表达式：(Less($open, $close)-$low)/$open，含义：K线下影线长度，反映盘中支撑力度）、STD5（表达式：Std($close, 5)/$close，含义：5日收盘价标准差，衡量纯价格波动幅度）。",
        "created_at": "2026-01-19T18:09:05.973772"
      },
      "backtest_results": {
        "1day.excess_return_with_cost.max_drawdown": -0.1339348137263956,
        "ICIR": 0.0510906385927068,
        "1day.excess_return_without_cost.std": 0.0044621713964561,
        "1day.excess_return_with_cost.annualized_return": 0.058404823182598,
        "1day.ffr": 1.0,
        "1day.excess_return_without_cost.mean": 0.0004439997782176,
        "1day.excess_return_without_cost.annualized_return": 0.1056719472157892,
        "1day.excess_return_with_cost.std": 0.0044648873074812,
        "Rank IC": 0.0250491263270071,
        "IC": 0.0073655575925203,
        "1day.excess_return_without_cost.max_drawdown": -0.0960669955060553,
        "1day.pos": 0.0,
        "1day.excess_return_without_cost.information_ratio": 1.5350586872275211,
        "1day.pa": 0.0,
        "l2.valid": 0.9961591992252304,
        "Rank ICIR": 0.1850123196269259,
        "l2.train": 0.9936493155896308,
        "1day.excess_return_with_cost.information_ratio": 0.847909952775992,
        "1day.excess_return_with_cost.mean": 0.0002453984167336
      },
      "feedback": {
        "observations": "The experiment results demonstrate a significant performance improvement over the SOTA across all key metrics. The Information Ratio increased from 1.06 to 1.53, and the Annualized Return rose from 7.0% to 10.5%. The IC also saw a substantial jump from 0.0044 to 0.0073. Two implementations were tested: one using raw deviations and a squared stability filter, and another using cross-sectional ranking. The results suggest that the combination of price deviation from the moving average, filtered by trend stability (RSQR) and confirmed by volume-weighted intraday support, provides a robust signal for capturing mean-reversion opportunities with reduced risk (lower Max Drawdown).",
        "hypothesis_evaluation": "The results strongly support the hypothesis. The non-linear interaction between the 5-day price deviation (PMA5) and the 10-day trend stability (RSQR10) successfully filters out noise in low-stability regimes. Specifically, the inclusion of the volume-weighted lower shadow (VW_KLOW3) as a liquidity support filter appears to have added a layer of validation that improved the Information Ratio and reduced the Max Drawdown compared to previous benchmarks.",
        "decision": true,
        "reason": "While the current results are strong, the use of SMA(5) might lag during sharp reversals; an EMA(5) would react faster to price turns. Furthermore, the volume-weighted lower shadow term is currently an absolute value added to the signal; by Z-scoring or normalizing this term relative to its own historical volatility, we ensure that the liquidity 'confirmation' is only impactful when it represents a significant deviation from the norm, potentially reducing false positives in low-volatility environments."
      },
      "cache_location": {
        "workspace_suffix": "exp_20260119_164725",
        "workspace_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_164725",
        "factor_dir": "4354263e72004b808d946b4207b7e240",
        "result_h5_path": "/mnt/DATA/quantagent/AlphaAgent/RD-Agent_workspace_exp_20260119_164725/4354263e72004b808d946b4207b7e240/result.h5"
      }
    }
  }
}